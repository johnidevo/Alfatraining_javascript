<!DOCTYPE html>
<html>
<body>
	
<div id="list"></div>
	
<script>
	
if (typeof(EventSource) == 'undefined') console.error('Connection aborted');

const evtSource = new EventSource("/source/script.php");

evtSource.addEventListener("message", (event) => {
	console.log(event);
	
  const newElement = document.createElement("li");
	const eventList = document.getElementById("list");
  newElement.textContent = `message: ${event.data}`;
  eventList.appendChild(newElement);
	
});
	
/*
evtSource.onmessage = (event) => {
  const newElement = document.createElement("li");
  const eventList = document.getElementById("list");
  newElement.textContent = `message: ${event.data}`;
  eventList.appendChild(newElement);
}

console.log(evtSource.withCredentials);
console.log(evtSource.readyState);
console.log(evtSource.url);
	
evtSource.addEventListener("ping", (event) => {
	//console.log(event);
  const newElement = document.createElement("li");
  const eventList = document.getElementById("list");
  const time = JSON.parse(event.data).time;
  newElement.textContent = `ping at ${time}`;
  eventList.appendChild(newElement);
});
*/

/*
	console.info('Starting connection...');
	var source = new EventSource('./source/script.php');
	source.addEventListener('open', function(e) {
			console.info('Connection was opened.');
	}, false);

	source.addEventListener('error', function(e) {
			var txt;
			switch (event.target.readyState) {
					// if reconnecting
					case EventSource.CONNECTING:
							txt = 'Reconnecting...';
							break;
					// if error was fatal
					case EventSource.CLOSED:
							txt = 'Connection failed. Will not retry.';
							break;
			}
			console.error('Connection error: ' + txt);
	}, false);

	source.addEventListener('message', function(e) {
			document.getElementById('result').innerHTML += e.data + '<br>';
			console.log(e.data);
	}, false);
*/
</script>
</body>
</html>